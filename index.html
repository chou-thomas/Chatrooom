<!DOCTYPE html>
<html>
<head>
	<title>Welcome to the Chatroom</title>
	<style>	
	#chatroom{
		height: 600px;
	}
	#infowrapper{
		display: none;
	}
	#messagewrapper{
		float: left;
		border: 2px solid black;
	}
	.error{
		color: red;
	}
	.private_msg{
		color: orange;
		font-style: italic;
	}

	</style>
</head>
<body>
	<div id = "namewrapper">
		<h5>Please enter a Name or Username</h5>
		<p id = "Error"><p>
			<form id = "setName">
				<input size = "40" id = "name"></input>
				<input type = "submit"></input>
			</form>
	</div>
	<h6>Online Users</h6>
	<div id = "users"></div>
	<div id = "infowrapper">
		<h5>Please Enter a message</h5>
		<div id = "messagewrapper">
			<div id ="chatroom"><div>
			<form id = "messages">
				<input size = "50" id = "message"></input>
				<input type = "submit"></input>
			</form>
		</div>
		<!-- <div id = "users"></div> -->
	</div>

	<script src = "https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<!-- jquery code -->
	<script>
	$( document ).ready(function(){
		//connection to the socket
		var socket = io.connect(); 
		//creating username variables from the html id's
		var $setName = $('#setName');
		var $error = $('#Error');
		var $name = $('#name');
		var $users = $('#users');

		// creating chat variables from the html id's
		var $sendMessage = $('#messages');
		var $message = $('#message');
		var $chatroom = $('#chatroom');


		$setName.submit(function(event){
			event.preventDefault();
			socket.emit('sending_user', $name.val(), function(data){ // perform callback to check if user exists
				if(data){
					$('#namewrapper').hide();
					$('#infowrapper').show();
					console.log('hello1');
				} else{
					$error.html('Username is taken');
					console.log("Error with username");
				}
			});

				$name.val('');
		});

		socket.on('usernames', function(data){
					var named = '';
					for(i = 0; i< data.length; i++){
						named += data[i] + '</br>'
					}
					$users.html(named);
					console.log(data);
		});
		
		$sendMessage.submit(function(event){
			// preventing the default behavior of pg ex: submit/ auto refresh
			event.preventDefault();
			socket.emit('sending_message', $message.val(), function(data){
			$chatroom.append('<span class = "error">' + data + '"</span><br/>');			
		});
			$message.val('');
		});

		socket.on('new_message', function(data){
			$chatroom.append('<b>' + data.name + ': </b>' + data.msg + '<br/>');
		});

		socket.on('private_msg', function(data){
			$chatroom.append('<span class = "private_msg"><b>' + data.name + ': </b>' + data.msg + '"</span><br/>');		
		})
	});
	</script>
</body>
</html>